version: 2
stages:
  build:
    machine: true
    working_directory: /home/circleci/go/src/github.com/drud/ghlabel

    environment:
      GOPATH: /home/circleci/go
      ARTIFACTS: /artifacts

    steps:
      - run: mkdir -p ~/go/src/github.com/drud/ghlabel && mkdir -p ~/go/lib && mkdir -p ~/go/bin
      - run: mkdir -p ~/artifacts
      - run: cp -r ~/go/bin ~/artifacts
      - checkout

      - run: make linux
      - run: make -s gofmt golint
      - run: make test
      - store_artifacts:
                path: /artifacts
                name: Artifact storage